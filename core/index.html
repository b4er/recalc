<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-terminal-4.7.0">
     
     
    <link rel="icon" type="image/png" sizes="192x192" href="../img/android-chrome-192x192.png" />
<link rel="icon" type="image/png" sizes="512x512" href="../img/android-chrome-512x512.png" />
<link rel="apple-touch-icon" sizes="180x180" href="../img/apple-touch-icon.png" />
<link rel="shortcut icon" type="image/png" sizes="48x48" href="../img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="../img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="../img/favicon-32x32.png" />


    
 
<title>Core Language - Recalc</title>


<link href="../css/fontawesome/css/fontawesome.min.css" rel="stylesheet">
<link href="../css/fontawesome/css/solid.min.css" rel="stylesheet">
<link href="../css/normalize.css" rel="stylesheet">
<link href="../css/terminal.css" rel="stylesheet">
<link href="../css/theme.css" rel="stylesheet">
<link href="../css/theme.tile_grid.css" rel="stylesheet">
<link href="../css/theme.footer.css" rel="stylesheet">
<!-- default color palette -->
<link href="../css/palettes/default.css" rel="stylesheet">

<!-- page layout -->
<style>
/* initially set page layout to a one column grid */
.terminal-mkdocs-main-grid {
    display: grid;
    grid-column-gap: 1.4em;
    grid-template-columns: auto;
    grid-template-rows: auto;
}

/*  
*   when side navigation is not hidden, use a two column grid.  
*   if the screen is too narrow, fall back to the initial one column grid layout.
*   in this case the main content will be placed under the navigation panel. 
*/
@media only screen and (min-width: 70em) {
    .terminal-mkdocs-main-grid {
        grid-template-columns: 4fr 9fr;
    }
}</style>



    
    <link href="../style.css" rel="stylesheet">  
    
    

    
    <!-- search css support -->
<link href="../css/search/bootstrap-modal.css" rel="stylesheet">
<!-- search scripts -->
<script>
    var base_url = "..",
    shortcuts = "{}";
</script>
<script src="../js/jquery/jquery-1.10.1.min.js" defer></script>
<script src="../js/bootstrap/bootstrap.min.js" defer></script>
<script src="../js/mkdocs/base.js" defer></script>
    
    
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script src="../search/main.js"></script>
    

    
</head>

<body class="terminal"><div class="container">
    <div class="terminal-nav">
        <header class="terminal-logo">
            <div id="mkdocs-terminal-site-name" class="logo terminal-prompt"><a href="/" class="no-style">Recalc</a></div>
        </header>
        
        <nav class="terminal-menu">
            
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href=".." class="menu-item " property="item" typeof="WebPage">
                        <span property="name">Introduction</span>
                    </a>
                    <meta property="position" content="0">
                </li>
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../install/" class="menu-item " property="item" typeof="WebPage">
                        <span property="name">Installation</span>
                    </a>
                    <meta property="position" content="1">
                </li>
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../build/" class="menu-item " property="item" typeof="WebPage">
                        <span property="name">Building from Source</span>
                    </a>
                    <meta property="position" content="2">
                </li>
                
                
                
                
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../development/" class="menu-item " property="item" typeof="WebPage">
                        <span property="name">Development Guide</span>
                    </a>
                    <meta property="position" content="3">
                </li>
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="/#" class="menu-item " property="item" typeof="WebPage">
                        <span property="name">‚Äã</span>
                    </a>
                    <meta property="position" content="4">
                </li>
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../haddock" class="menu-item " property="item" typeof="WebPage">
                        <span property="name">üêü Haddock</span>
                    </a>
                    <meta property="position" content="5">
                </li>
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="https://github.com/b4er/recalc" class="menu-item " property="item" typeof="WebPage">
                        <span property="name">üêô GitHub</span>
                    </a>
                    <meta property="position" content="6">
                </li>
                
                    
                    


<li property="itemListElement" typeof="ListItem">
    <a href="#" class="menu-item" data-toggle="modal" data-target="#mkdocs_search_modal" property="item" typeof="SearchAction">
        <i aria-hidden="true" class="fa fa-search"></i> <span property="name">Search</span>
    </a>
    <meta property="position" content="7">
</li>
                    
            </ul>
            
        </nav>
    </div>
</div>
        
    <div class="container">
        <div class="terminal-mkdocs-main-grid"><aside id="terminal-mkdocs-side-panel"><nav>
  
    <ul class="terminal-mkdocs-side-nav-items">
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="..">Introduction</a>
        
    
    
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../install/">Installation</a>
        
    
    
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../build/">Building from Source</a>
        
    
    
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Architecture</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../backend/">Backend</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../frontend/">Frontend</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        <span class="
        
    

    terminal-mkdocs-side-nav-item--active terminal-mkdocs-side-nav-section-no-index">Usage</span>
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        <span class="

    terminal-mkdocs-side-nav-item--active">Core Language</span>
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../library/">As a Library</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../development/">Development Guide</a>
        
    
    
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="/#">‚Äã</a>
        
    
    
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../haddock">üêü Haddock</a>
        
    
    
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="https://github.com/b4er/recalc">üêô GitHub</a>
        
    
    
    
  </li>
        
    </ul>
  
</nav><hr>
<nav>
    <ul>
        <li><a href="#core-language-modulo-changes-new-features-and-bugs">Core Language (modulo changes, new features and bugs)</a></li>
        <li><a href="#syntax">Syntax</a></li><li><a href="#typechecking-and-inference">Typechecking and Inference</a></li><li><a href="#evaluation">Evaluation</a></li>
    </ul>
</nav>
</aside>
            <main id="terminal-mkdocs-main-content">
<section id="mkdocs-terminal-content">
    <h1 id="core-language-modulo-changes-new-features-and-bugs">Core Language (modulo changes, new features and bugs)</h1>
<p>The provided core language (see <a href="./haddock/recalc/recalc-spec/Recalc-Language.html"><code>Recalc.Language</code></a>)
implements a simple, dependently typed functional programming language
based on LambdaPi<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>, which is extended by</p>
<ul>
<li>cell references (sized, nested multi-dimensional arrays), and</li>
<li>implicit arguments.</li>
</ul>
<h2 id="syntax">Syntax</h2>
<p>Cell references and ranges are similar to Excel:</p>
<p>
<script type="math/tex; mode=display">\begin{aligned}
\mathfrak{m} \
  \mathrel{::=} & 1 \mid 2 \mid \dots \\
\mathfrak{n} \
  \mathrel{::=} & \text{A} \mid \text{B} \mid
      \dots \mid \text{AA} \mid \dots \\
\alpha
  \ \mathrel{::=} & \ \mathfrak{n}\ \mathfrak{m}
          \mid \mathfrak{n}\ \mathfrak{m}\ \textbf{:}\ \mathfrak{n}\ \mathfrak{m} \\
\\
\textit{sheet-id}
  \ \mathrel{::=} &
    \ \textit{simple-sheet-name}
    \\ \mid &
    \ \texttt{'} \textit{sheet-name} \texttt{'}
    \\ \mid &
    \ \texttt{[}\ \textit{simple-uri}\ \texttt{]} \textit{simple-sheet-name}
    \\ \mid &
    \ \texttt{'[}\ \textit{uri}\ \texttt{]} \textit{sheet-name} \texttt{'} \\
\\
\xi
  \ \mathrel{::=} & \ \Bigl[\textit{sheet-id}\ \textbf{!}\Bigr]\ \alpha
\end{aligned}</script>
</p>
<p>Where <script type="math/tex">\textit{uri}</script> and <script type="math/tex">\textit{sheet-name}</script> must be printable, and
characters <code>'[]\</code> need to be escaped with <code>\</code>. The corresponding <script type="math/tex">\textit{simple-}</script>
prefixed versions may only contain alphanumeric characters and <code>._~</code>.</p>
<p>When <script type="math/tex">\textit{sheet-id}</script> is not (or partially) provided, it is
implicitly defined as the <script type="math/tex">\textit{uri}</script> and/or <script type="math/tex">\textit{sheet-name}</script>
of the location where it is being read.</p>
<p>Terms and types share the syntax of a standard lambda calculus with dependent
functions:</p>
<p>
<script type="math/tex; mode=display">\begin{array}{ll}
\text{f}, \text{x}, \sigma, \tau & \mathrel{::=}
    & \textit{literal}
            & \color{grey}{\text{-- decimals and Boolean values}}
  \\ & \mid & \text{v}
            & \color{grey}{\text{-- variables}}
  \\ & \mid & \texttt{\\} \text{v}\ \texttt{->}\ \text{x}
            & \color{grey}{\text{-- lambda abstraction}}
  \\ & \mid & \texttt{*}
            & \color{grey}{\text{-- kind of types}}
  \\ & \mid & \texttt{(} \text{v}\texttt{:}\ \sigma \texttt{) -> } \tau
            & \color{grey}{\text{-- dependent function type}}
  \\ & \mid & \texttt{\{} \text{v}\texttt{:}\ \sigma \texttt{\} -> } \tau
            & \color{grey}{\text{-- implicit dependent function type}}
  \\ & \mid & \xi
            & \color{grey}{\text{-- cell reference}}
  \\ & \mid & \text{f(x}_1, \dots\text{)}
            & \color{grey}{\text{-- application}}
  \\ & \mid & \text{f\{x}_1, \dots\text{\}}
            & \color{grey}{\text{-- explicit application of an implicit argument}}
\end{array}</script>
</p>
<p>where <script type="math/tex">\textit{literal}</script> includes signed decimals, <code>int</code>, <code>bool</code>, <code>false</code>,
and <code>true</code>. Identifiers are case-insensitive.</p>
<p>When a function type ignores its argument it can be written as
<script type="math/tex">\sigma \texttt{ -> } \tau</script> and similarly
<script type="math/tex">\text{\{}\sigma\text{\}} \texttt{ -> } \tau</script> for implicit arguments.</p>
<h2 id="typechecking-and-inference">Typechecking and Inference</h2>
<p>The typing judgements and evaluation rules follow directly the <code>LambdaPi</code>
implementation (a simple bi-directional typechecker). The only notable
difference is that we introduce another context <script type="math/tex">\sigma</script> which gives
the type <script type="math/tex">\sigma_T(\xi)</script> and value <script type="math/tex">\sigma_V(\xi)</script> of a cell.</p>
<p>The original rules are trivially extended, passing the additional <script type="math/tex">\sigma</script>
around. For example, the rule <script type="math/tex">\small{\text{CHK}}</script> would be extended as
follows:</p>
<p>
<script type="math/tex; mode=display">\begin{array}{c}
  \Gamma, \sigma\ \vdash\ e\ ::_{\uparrow}\ \tau \\ \hline
  \Gamma, \sigma\ \vdash\ e\ ::_{\downarrow}\ \tau
\end{array}</script>
</p>
<h3 id="cell-references">Cell References</h3>
<p>Rules concerning cell references and cell ranges make use of the new type
constructor <script type="math/tex">\text{<}..\text{>[}\tau\text{]}</script> for tensors (not part of the
surface language) and are quite simple:</p>
<p>
<script type="math/tex; mode=display">\begin{array}{c}
  \sigma_T(\textit{sheet-id}\ \textbf{!}\ \mathfrak{n}\ \mathfrak{m}) = \tau \\ \hline
  \Gamma, \sigma\ \vdash\ \textit{sheet-id}\ \textbf{!}\ \mathfrak{n}\ \mathfrak{m}\ ::_{\uparrow}\ \tau
\end{array}</script>
</p>
<p>
<script type="math/tex; mode=display">\begin{array}{c}
  \sigma_T(\textit{sheet-id}\ \textbf{!}\ \mathfrak{n}\ \mathfrak{m}) = \tau \\
  \forall i j. (i,j) \in \mathfrak{n}\ \mathfrak{m}\ \textbf{:}\ \mathfrak{n}'\ \mathfrak{m}'
    \implies \sigma_T(\textit{sheet-id}\ \textbf{!} (i,j)) = \tau \\
  m = \mathfrak{m}' - \mathfrak{m} \land n = \mathfrak{n}' - \mathfrak{n} \\
  dims = \text{inferDimensions}(m, n, \tau) \\ \hline
  \Gamma, \sigma
    \ \vdash\
    \textit{sheet-id}\ \textbf{!}\ \mathfrak{n}\ \mathfrak{m}\ \textbf{:}\ \mathfrak{n}'\ \mathfrak{m}'
    ::_{\uparrow}
    \text{<}dims\text{>}\lfloor\tau\rfloor
\end{array}</script>
</p>
<p>The first one just states that a simple cell reference has the same type as the
type of the term at that location.</p>
<p>The second one is similar. Using the top left corner of a selection it makes sure
that all cells in the referred range share that type <script type="math/tex">\tau</script>. The type of a cell
range is a tensor with elements <script type="math/tex">\lfloor\tau\rfloor</script>.</p>
<p>(where <script type="math/tex">\lfloor\_\rfloor</script> is an identity for all types except tensor types
<script type="math/tex">\text{<}..\text{>[}\tau'\text{]}</script> for which it is defined as <script type="math/tex">\tau'</script>)</p>
<p>The dimensions of the resulting tensor are given by</p>
<p>
<script type="math/tex; mode=display">
  \text{inferDimensions}(m,n,\tau) \mathrel{::=}
  \begin{cases}
    n, \text{dim}(\tau) & \text{if }m = 1, \\
    m, \text{dim}(\tau) & \text{if }n = 1, \\
    m, n, \text{dim}(\tau) & \text{otherwise}.
  \end{cases}
</script>
</p>
<p>
<script type="math/tex; mode=display">
  \text{dim}(\tau) \mathrel{::=}
  \begin{cases}
    \bar{d}   & \text{if }\tau\text{ has shape <}\bar{d}\text{>[}\tau'\text{]}, \\
    \small{\text{[ ]}} & \text{otherwise}.
  \end{cases}
</script>
</p>
<p>That is, referring to an <script type="math/tex">m \times n</script> range of cells gives a tensor which
potentially can become higher order when the elements are tensors by themselves.</p>
<h3 id="implicit-arguments">Implicit Arguments</h3>
<p>Implicit arguments are covered by</p>
<p>
<script type="math/tex; mode=display">\begin{array}{c}
  \Gamma, \sigma
    \ \vdash\ \texttt{f} ::_{\uparrow}
      \texttt{\{} \texttt{v}\texttt{:}\ \sigma \texttt{\} -> } \tau' \\
  \Gamma, \sigma
    \ \vdash\ \texttt{x} ::_{\downarrow} \sigma \\
  \tau' \bigl[\texttt{v} \mapsto \texttt{x}\bigr] \Downarrow\ \tau'
  \\ \hline
  \Gamma, \sigma
    \ \vdash\ \texttt{f\{x\}} ::_{\uparrow} \tau'
\end{array}</script>
</p>
<p>which follows the regular application rule, and</p>
<p>
<script type="math/tex; mode=display">\begin{array}{c}
  \Gamma, \sigma
    \ \vdash\ \texttt{f} ::_{\uparrow}
      \prod_i\texttt{\{} \texttt{v}_i\texttt{:}\ \sigma_i \texttt{\}.}
      \texttt{ (v: }\sigma\texttt{) -> } \tau
  \\
  \Gamma, \sigma
    \ \vdash\ \texttt{x} ::_{\uparrow} \sigma' \\
  I, S = \text{unify(}\sigma, \sigma'\text{)} \\
  \tau \bigl[\texttt{v} \mapsto \texttt{x}\bigr] S \Downarrow\ \tau'
  \\ \hline
  \Gamma, \sigma
    \ \vdash\ \texttt{f(x)} ::_{\uparrow}
      \prod_{i \in I}\texttt{\{v}_i\texttt{: }\sigma_i\texttt{\} -> }\tau'
\end{array}</script>
</p>
<p>which uses unification to solve for implicict arguments (and leaves uninferrable
untouched out). That is, <script type="math/tex">I</script> is the set of variables which are left unsolved by
<script type="math/tex">\text{unify}</script>, and <script type="math/tex">S</script> is a substitution from implicit variables to the solved
terms that unifies <script type="math/tex">\sigma'</script> and <script type="math/tex">\sigma'</script>.</p>
<h2 id="evaluation">Evaluation</h2>
<p>The evaluation rules for the language extended to spreadsheets are equally
simple. They abstract the recalculation using the context <script type="math/tex">\sigma</script> introduced
earlier and extends existing rules accordingly.</p>
<p>The new rules become:</p>
<p>
<script type="math/tex; mode=display">\begin{array}{c}
  \sigma_V(\textit{sheet-id}\ \textbf{!}\ \mathfrak{n}\ \mathfrak{m}) = v \\ \hline
  \sigma\ \vdash\ \textit{sheet-id}\ \textbf{!}\ \mathfrak{n}\ \mathfrak{m}\ \Downarrow\ v
\end{array}</script>
</p>
<p>
<script type="math/tex; mode=display">\begin{array}{c}
  \sigma_V(\textit{sheet-id}\ \textbf{!}\ (i,j)) = v_{i,j} \\ \hline
  \sigma\ \vdash\ \textit{sheet-id}\ \textbf{!}
    \ \mathfrak{n}\ \mathfrak{m}\ \textbf{:}\ \mathfrak{n}'\ \mathfrak{m}'
    \Downarrow\ [ \text{..} v_{i,j} ]_{
      (i,j) \in \mathfrak{n}\ \mathfrak{m}\ \textbf{:}\ \mathfrak{n}'\ \mathfrak{m}'
    }
\end{array}</script>
</p>
<p>(where <script type="math/tex">\text{..}\_</script> flattens a tensor value and acts as an identity otherwise)</p>
<hr />
<p>Thus references to cell ranges behave as nested arrays with dependently typed
sizes:</p>
<p><img alt="function-ref" src="../gifs/cell-refs.gif" /></p>
<!-- !!! warning "‚ö†Ô∏è There may be constructs implemented that are not documented here" -->

<!-- Footnotes & References -->
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Andres L√∂h, Conor McBride, Wouter Swierstra. <a href="https://dl.acm.org/doi/10.5555/1883634.1883637"><em>A Tutorial Implementation of a Dependently Typed Lambda Calculus</em></a>.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
</section>

            </main>
        </div>
        <hr><footer>
    <div class="terminal-mkdocs-footer-grid">
        <div id="terminal-mkdocs-footer-copyright-info">
             Site built with <a href="http://www.mkdocs.org">MkDocs</a> and <a href="https://github.com/ntno/mkdocs-terminal">Terminal for MkDocs</a>.
        </div>
    </div>
</footer>
    </div>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="alertdialog" aria-modal="true" aria-labelledby="searchModalLabel">
    <div class="modal-dialog modal-lg" role="search">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="searchModalLabel">Search</h5>
                <button type="button" class="close btn btn-default btn-ghost" data-dismiss="modal"><span aria-hidden="true">x</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p id="searchInputLabel">Type to start searching</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" aria-labelledby="searchInputLabel" placeholder="" id="mkdocs-search-query" title="Please enter search terms here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No document matches found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    
    
</body>

</html>